{{#each contexts}}
/// <reference path="./{{fileName}}" />
{{/each}}
/// <reference path="./vari/index.d.ts" />
/// <reference path="./schemas/index.d.ts" />
/// <reference path="./tabi/index.d.ts" />

{{#each contexts}}
{{#if firstLevel}}
export const {{name}}: {{interfaceName}};
{{/if}}
{{/each}}

declare const poly: Poly;
export default poly;

export type UnregisterWebhookEventListener = () => void;
export type UnregisterGraphQLSubscriptionEventListener = () => void;
export type AuthFunctionCallback = (token?: string, url?: string, error?: any) => any;

export interface AuthFunctionResponse<T> {
  status: number;
  data: T;
  headers: Record<string, string>;
}

export interface ApiFunctionResponse<T> {
  status: number;
  data: T;
  headers: Record<string, string>;
  metrics: {
    roundTripNetworkLatencyMs?: number;
    serverExecutionTimeMs?: number;
  };
}

export interface GraphqlAPIFunctionResponse<T> {
  status: number;
  headers: Record<string, string>;
  data: Partial<T & { errors?: any[]}>
}

export interface ErrorEvent {
  message: string;
  data?: any;
  status?: number;
  statusText?: string;
  functionId: string;
  applicationId?: string;
  userId?: string;
}
export interface ErrorHandlerOptions {
  applicationIds?: string[];
  environmentIds?: string[];
  functionIds?: string[];
  tenant?: boolean;
}
export type UnregisterErrorHandler = () => void;

interface ErrorHandler {
  on: (path: string, handler: (error: ErrorEvent) => void, options?: ErrorHandlerOptions) => UnregisterErrorHandler;
}
export const errorHandler: ErrorHandler;
export const vari: vari.Vari;
export const tabi: tabi.Tabi;

/**
 * This type contain all schemas saved into poly.
 */
export type schemas = schemas.Schemas

interface AuthData {
  apiKeyId: string;
  apiKeyName: string;
  ssoUserId: string | null;
  identityProviderId: string | null;
  canSwitchEnvironments: boolean;
  createdAt: Date;
  expiresAt: Date | null;
  tenant: poly.Oob.Polyapi.Tenant.Get.ReturnType;
  environment: poly.Oob.Polyapi.Environments.Get.ReturnType;
  application: poly.Oob.Polyapi.Applications.Get.ReturnType | null;
  user: poly.Oob.Polyapi.Users.Get.ReturnType | null;
  permissions: poly.Oob.Polyapi.PermissionPolicies.Get.ReturnType;
  claims: Record<string, any>;
}

interface PolyCustom {
  readonly executionId?: string;
  executionApiKey: string | undefined | null;
  userSessionId: string | undefined;
  responseStatusCode: number;
  responseContentType: string;
  responseHeaders: Record<string, string | string[]>;
  authData: Partial<AuthData>;
}
export const polyCustom: PolyCustom;
