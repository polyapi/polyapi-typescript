{{#each contexts}}
/// <reference path="./{{fileName}}" />
{{/each}}
/// <reference path="./vari/index.d.ts" />
/// <reference path="./schemas/index.d.ts" />
/// <reference path="./tabi/index.d.ts" />

{{#each contexts}}
{{#if firstLevel}}
export const {{name}}: {{interfaceName}};
{{/if}}
{{/each}}

declare const poly: Poly;
export default poly;

export type UnregisterWebhookEventListener = () => void;
export type UnregisterGraphQLSubscriptionEventListener = () => void;
export type AuthFunctionCallback = (token?: string, url?: string, error?: any) => any;

export interface AuthFunctionResponse<T> {
  status: number;
  data: T;
  headers: Record<string, string>;
}

export interface ApiFunctionResponse<T> {
  status: number;
  data: T;
  headers: Record<string, string>;
  metrics: {
    roundTripNetworkLatencyMs?: number;
    serverExecutionTimeMs?: number;
  };
}

export interface GraphqlAPIFunctionResponse<T> {
  status: number;
  headers: Record<string, string>;
  data: Partial<T & { errors?: any[]}>
}

export interface ErrorEvent {
  message: string;
  data?: any;
  status?: number;
  statusText?: string;
  functionId: string;
  applicationId?: string;
  userId?: string;
}
export interface ErrorHandlerOptions {
  applicationIds?: string[];
  environmentIds?: string[];
  functionIds?: string[];
  tenant?: boolean;
}
export type UnregisterErrorHandler = () => void;

interface ErrorHandler {
  on: (path: string, handler: (error: ErrorEvent) => void, options?: ErrorHandlerOptions) => UnregisterErrorHandler;
}
export const errorHandler: ErrorHandler;
export const vari: vari.Vari;
export const tabi: tabi.Tabi;

/**
 * This type contain all schemas saved into poly.
 */
export type schemas = schemas.Schemas

interface AuthData {
  apiKeyId: string;
  apiKeyName: string;
  ssoUserId: string | null;
  identityProviderId: string | null;
  canSwitchEnvironments: boolean;
  createdAt: string;
  expiresAt: string | null;
  tenant: {
    id: string;
    name: string;
    email: string;
    ssoId: string;
    publicVisibilityAllowed: boolean;
    tierId: string;
    publicNamespace: string;
    enabled: boolean;
  };
  environment: {
    id: string;
    name: string;
    context: string;
    contextName: string;
    description: string;
    subdomain: string;
    logsDefault: boolean;
    metricsEnabled: boolean;
  };
  application: {
    id: string;
    name: string;
    subpath: string;
    description: string;
    visibility: 'ENVIRONMENT' | 'TENANT' | 'PUBLIC';
    config: {
      name: string;
      subpath?: string;
      icon?: string;
      collections: Record<string, unknown>[];
      login?: Record<string, unknown>;
      signUp?: Record<string, unknown>;
    };
  } | null;
  user: {
    id: string;
    name: string;
    email: string;
    ssoId: string;
    role: 'USER' | 'ADMIN' | 'SUPER_ADMIN';
  } | null;
  permissions: {  
    execute?: boolean;  
    libraryGenerate?: boolean;  
    useApplications?: boolean;  
    manageApiFunctions?: boolean;  
    manageWebhooks?: boolean;  
    manageTriggers?: boolean;  
    customDev?: boolean;  
    manageGraphQLSubscriptions?: boolean;  
    manageApplications?: boolean;  
    manageSchemas?: boolean;  
    authConfig?: boolean;  
    manageSnippets?: boolean;  
    manageVariables?: boolean;  
    manageSecretVariables?: boolean;  
    manageJobs?: boolean;  
    manageUsers?: boolean;  
    manageTenant?: boolean;  
    manageTables?: boolean;  
    queryTables?: boolean;  
    [k: string]: unknown;  
  };
  claims: Record<string, any>;
}

interface PolyCustom {
  readonly executionId?: string;
  executionApiKey: string | undefined | null;
  userSessionId: string | undefined;
  responseStatusCode: number;
  responseContentType: string;
  responseHeaders: Record<string, string | string[]>;
  authData: Partial<AuthData>;
}
export const polyCustom: PolyCustom;
